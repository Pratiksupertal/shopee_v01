<style>
.tac{text-align: center;}
.tar{text-align: right;}
.brs{border-right: hidden;}
.color{color: #d1d8dd;}
.fsize{font-size: 20px;}
.blh{border-left: hidden;}
.bbh{border-bottom: hidden; }
.f_font{font-family: Calibri, Candara, Segoe, Optima, Arial, sans-serif;}
</style>
<div class="print-heading">

<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.9.0/dist/JsBarcode.all.min.js">
</script>

<svg class="barcode"
jsbarcode-fontsize="10"
jsbarcode-height="40"
jsbarcode-value="{{doc.name}}"/>
{% set username = ""%}
{% if frappe.session.user != "Administrator" %}
{% set user = frappe.get_doc('User', frappe.session.user)%}
{% set username= user.full_name %} {% endif %}
{% if frappe.session.user == "Administrator"%}
{% set username= frappe.session.user %} {% endif %}
{% set name=namespace(name="") %}
{% set role2=namespace(role2="") %}
{% set user_name = frappe.get_all('User', filters={'full_name': username}, fields=['name']) %}
  {% for user_name in user_name %}
     {% set name.name = user_name.name%}
  {% endfor %}
{% set hasrole = frappe.get_all('Has Role', filters={'parent': name.name}, fields=['role']) %}
  {% for hasrole in hasrole %}
     {% if ((hasrole.role == "Accounting Supervisor") or (hasrole.role == "CEO") or (hasrole.role=="Accounts Manager") or (hasrole.role=="ISS Purchase User") or (hasrole.role=="Purchase AP")) %}
        {% set role2.role2=hasrole.role %}
     {% endif %}

  {% endfor %}
{% set uom=namespace(uom_name="") %}
{% set disc=namespace(discount=0) %}

<h2 style="font-size:16px;font-weight:bold;">Purchase Order<br><small style="font-weight:bold;">{{ doc.name }}</small></h2></div>

<script>JsBarcode(".barcode").init();</script>
<!--<div class="row section-break f_font">
    <table width="100%" style="table-layout: fixed;margin-bottom:30px;" border="0px" bordercolor="#a9a9a9">
      <tr>
        <td colspan="12" class="fsize tac blh brs bbh"><b>Purchase Order</b></td>
      </tr>
    </table>
</div>-->
<div class="row section-break f_font">
  <div class="col-xs-6">
    <table width="100%" style="table-layout: fixed;">
      <tr>
        <td width="40%"><b>Nama Supplier</b></td>
        <td width="60%">{{ doc.supplier or '' }}</td>
      </tr>
      <tr>
        <td width="40%"><b>Alamat</b></td>
        <td width="60%">{{ doc.address_display or '' }}</td>
      </tr>
    </table>
  </div>
  <div class="col-xs-6">
    <table width="100%" style="table-layout: fixed;">
      <tr>
        <td colspan="6"><b>Purchase Order No</b></td>
        <td colspan="6">{{ doc.name or ''}}</td>
      </tr>
      <tr>
        <td colspan="6"><b>Tanggal</b></td>
        <td colspan="6">{{ frappe.utils.formatdate(doc.get_formatted('schedule_date'), "dd-mm-yyyy") }}</td>
      </tr>
    </table>
  </div>
</div>
<br>

<br>
<div class="row section-break f_font">
<div class="col-xs-12">
<table width="100%" style="table-layout: fixed;" border="1px" bordercolor="#d1d8dd">
<tr>
{% if (role2.role2 == "Accounting Supervisor") or (role2.role2 == "CEO") or (role2.role2=="Accounts Manager") or (role2.role=="ISS Purchase User") or (role2.role=="Purchase AP") %}
<th class="tac" width="10%"><b>No.</b></th>
<th class="tac" width="32%"><b>Kode Barang dan Deskripsi</b></th>
<th class="tac" width="18%"><b>Image</b></th>
<!-- <th class="tac" width="15%"> <b>Image</b></th> -->
<th class="tac" width="15%"><b>Quantity</b></th>
<th class="tac" width="15%"><b>Harga</b></th>
<th class="tac" width="20%"><b>Total</b></th>
{% else %}
<th class="tac" width="10%"><b>No.</b></th>
<th class="tac" width="47%"><b>Kode Barang dan Deskripsi</b></th>
<th class="tac" width="23%"><b>Image</b></th>
<!-- <th class="tac" width="15%"> <b>Image</b></th> -->
<th class="tac" width="25%"><b>Quantity</b></th>
{% endif %}
</tr>
{% set amt=namespace(price_amount=0) %}
{% for row in doc.items %}
<tr>
<td class="tac" width="10%">{{ row.idx or '' }}</td>
{% set uom.uom_name= row.uom %}
{% set fmt_qty = frappe.utils.fmt_money(row.qty,currency="") %}
{% set price_tag = row.price_list_rate * row.qty %}
{% set fmt_price_tag = frappe.utils.fmt_money(price_tag,currency="") %}
{% if (role2.role2 == "Accounting Supervisor") or (role2.role2 == "CEO") or (role2.role2=="Accounts Manager") or (role2.role=="ISS Purchase User") or (role2.role=="Purchase AP") %}
<td width="32%">{{ row.item_code or '' }} <br> {{ row.item_name}} <br>{{ row.description or '' }}</td>
{% set fmt_price_list_rate = frappe.utils.fmt_money(row.price_list_rate,currency="") %}

<!-- <td class="tac" width="15%"> <img id="item_img" src= '{{ row.image }}'></td> -->
<td class="tac" width="18%"><img src='{{ row.image }}'></td>
<td class="tac" width="15%">{{ fmt_qty or ''}}&nbsp;{{ row.uom or ''}}</td>
<td class="tac" width="15%"> {% if doc.currency == "IDR" %}
  {{doc.currency}} {{ fmt_price_list_rate or ''}} {% endif %} {% if doc.currency == "USD" %}
  {{doc.currency}} {{ fmt_price_list_rate or ''}} {% endif %}
</td>
<td class="tac" width="20%" style="text-align: right;"> {{doc.currency}} {{ fmt_price_tag  or ''}}</td>
{% else %}
  <td width="47%">{{ row.item_code or '' }} <br> {{ row.item_name}} <br>{{ row.description or '' }}</td>
  <!-- <td class="tac" width="15%"> <img id="item_img" src= '{{ row.image }}'></td> -->
  <td class="tac" width="23%"><img src='{{ row.image }}'></td>
  <td class="tac" width="25%">{{ fmt_qty or ''}}&nbsp;{{ row.uom or ''}}</td>

{% endif %}
{% set amt.price_amount=amt.price_amount+price_tag %}
{% set discount = row.discount_amount * row.qty%}
{% set disc.discount=disc.discount+ discount %}
</tr>
{% endfor %}
<tr>
  {% set fmt_total_qty = frappe.utils.fmt_money(doc.total_qty,currency="") %}
  {% set fmt_amt_price_amount = frappe.utils.fmt_money(amt.price_amount,currency="") %}
  <td class="tac" colspan="3">Total Quantity</td><td class="tac">{{fmt_total_qty}}</td><td></td>
  <td class="tac" style="text-align: right;">{% if (role2.role2 == "Accounting Supervisor") or (role2.role2 == "CEO") or (role2.role2=="Accounts Manager") or (role2.role=="ISS Purchase User") or (role2.role=="Purchase AP") %}{{doc.currency}} {{fmt_amt_price_amount}} {% endif %}</td>
</tr>
</table>
<div class="">
  <div class="col-xs-6">
    </div>
  <div class="col-xs-6">
    <table width="100%" style="table-layout: fixed;    margin-left: 15px;">
      {% set fmt_total = frappe.utils.fmt_money(doc.total,currency="") %}
      <tr>
        <td colspan="6"><b>{% if (role2.role2 == "Accounting Supervisor") or (role2.role2 == "CEO") or (role2.role2=="Accounts Manager") or (role2.role=="ISS Purchase User") or (role2.role=="Purchase AP") %}Total {% endif %}</b></td>
        <td colspan="6" style="text-align: right;">{% if (role2.role2 == "Accounting Supervisor") or (role2.role2 == "CEO") or (role2.role2=="Accounts Manager") or (role2.role=="ISS Purchase User") or (role2.role=="Purchase AP") %}{{doc.currency}}&nbsp;{{ fmt_total or '' }}{% endif %}</td>
      </tr>
      <tr>
        <td colspan="6"><b>{% if (role2.role2 == "Accounting Supervisor") or (role2.role2 == "CEO") or (role2.role2=="Accounts Manager") or (role2.role=="ISS Purchase User") or (role2.role=="Purchase AP") %}Diskon{% endif %}</b></td>
        {% set fmt_tot_disc_percentage= doc.additional_discount_percentage %}
        {% set tot_disc =  (doc.total * doc.additional_discount_percentage)/100 %}
        {% set fmt_tot_disc = frappe.utils.fmt_money(tot_disc,currency="") %}
        <td colspan="6" style="text-align: right;">{% if (role2.role2 == "Accounting Supervisor") or (role2.role2 == "CEO") or (role2.role2=="Accounts Manager") or (role2.role=="ISS Purchase User") or (role2.role=="Purchase AP") %}{{doc.currency}} {{ fmt_tot_disc or '0'}}&nbsp;{{'('}}{{fmt_tot_disc_percentage}}&nbsp;{{'%)'}}{% endif %}</td>
      </tr>
      <tr>
        <td colspan="6"><b>{% if (role2.role2 == "Accounting Supervisor") or (role2.role2 == "CEO") or (role2.role2=="Accounts Manager") or (role2.role=="ISS Purchase User") or (role2.role=="Purchase AP") %}Total setelah Diskon{% endif %}</b></td>
        {% set fmt_net_total = frappe.utils.fmt_money(doc.net_total,currency="") %}
        <td colspan="6" style="text-align: right;">{% if (role2.role2 == "Accounting Supervisor") or (role2.role2 == "CEO") or (role2.role2=="Accounts Manager") or (role2.role=="ISS Purchase User") or (role2.role=="Purchase AP") %}{{doc.currency}} {{ fmt_net_total }}{% endif %}</td>
      </tr>
      {% if doc.taxes_and_charges %}
      <tr>
        {% set fmt_total_taxes_and_charges = frappe.utils.fmt_money(doc.total_taxes_and_charges,currency="") %}
        <td colspan="6"><b>{% if (role2.role2 == "Accounting Supervisor") or (role2.role2 == "CEO") or (role2.role2=="Accounts Manager") or (role2.role=="ISS Purchase User") or (role2.role=="Purchase AP") %}PPN{% endif %}</b></td>
        <td colspan="6" style="text-align: right;">{% if (role2.role2 == "Accounting Supervisor") or (role2.role2 == "CEO") or (role2.role2=="Accounts Manager") or (role2.role=="ISS Purchase User") or (role2.role=="Purchase AP") %} {{doc.currency}} {{fmt_total_taxes_and_charges}}{% endif %}
        </td>
      </tr>
      {% endif %}
      <tr>
        <td colspan="6"><b>{% if (role2.role2 == "Accounting Supervisor") or (role2.role2 == "CEO") or (role2.role2=="Accounts Manager") or (role2.role=="ISS Purchase User") or (role2.role=="Purchase AP") %}Grand Total{% endif %}</b></td>
        {% set fmt_grand_total = frappe.utils.fmt_money(doc.grand_total,currency="") %}
        <td colspan="6" style="text-align: right;">{% if (role2.role2 == "Accounting Supervisor") or (role2.role2 == "CEO") or (role2.role2=="Accounts Manager") or (role2.role=="ISS Purchase User") or (role2.role=="Purchase AP") %} {{doc.currency}} {{fmt_grand_total}}{% endif %}
        </td>
      </tr>
    </table>

</div>
<br><br>
<div class="col-xs-2">
  Catatan :
</div>
<div class="col-xs-10">
  {{doc.remarks or ""}} <br>
</div>
<br>
<div class="col-xs-2">
  Cara Packing :
</div>
<div class="col-xs-10">
  {{doc.cara_packing or ""}} <br>
</div>
</div>
</div>
<div class="col-xs-12">
  <div class="col-xs-2">
    <b>Sample</b>
  </div>
    {% for row in doc.items %}
    <div class="col-xs-2">
      {% if row.sample_image %}
      <img id="item_img" src= '{{ row.sample_image }}'>
      {% endif %}
    </div>
  {% endfor %}
</div>
<div class="row section-break f_font">
<div class="col-xs-12">
<table width="100%" style="table-layout: fixed;">
<tr><td colspan="12"></td></tr>


<tr><td colspan="12" height="70px"></td></tr>
<tr>
<td colspan="3" class="tac "> <u> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {{doc.approve_po or ''}} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</u> </td>
<td colspan="3" class="tac "> <u>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{doc.check_po or ''}}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</u> </td>
<td colspan="3" class="tac " style=""> <u>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{ username }}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</u> </td>
<td colspan="3" class="tac "> <u></u> </td>
</tr>

<tr>
<td colspan="3" class="tac"><b>Approved By</b></td>
<td colspan="3" class="tac"><b>Checked By</b></td>
<td colspan="3" class="tac"><b>Prepared By</b></td>
<td colspan="3" class="tac"><b>Reviewed By</b></td>
</tr>
</table>
</div>
</div>
